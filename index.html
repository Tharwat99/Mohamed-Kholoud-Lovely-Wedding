<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Mohamed & Kholoud Lovely Wedding</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500&family=El+Messiri:wght@400;700&family=Reem+Kufi&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
        
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
            import { getFirestore, collection, addDoc, serverTimestamp, getDocs, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

            // Your web app's Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyDczRATNnQOBJHF1D9EDdhQHee3dbfDKg4",
                authDomain: "mohamed-kholoud-wedding.firebaseapp.com",
                projectId: "mohamed-kholoud-wedding",
                storageBucket: "mohamed-kholoud-wedding.firebasestorage.app",
                messagingSenderId: "113692483577",
                appId: "1:113692483577:web:87688e5eaf40ffe22ea728"
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            // Make Firebase available globally
            window.firebaseApp = app;
            window.firestore = db;
            window.firebaseModules = { collection, addDoc, serverTimestamp, getDocs, query, where, orderBy };
            
            console.log("Firebase initialized successfully");
        </script>

        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            :root {
                --primary: #f8e9e9;
                --secondary: #d4af37;
                --accent: #c89b7b;
                --dark: #3a2c2c;
                --light: #fffaf0;
                --gold-glow: 0 0 20px rgba(197, 167, 70, 0.5);
            }

            body {
                font-family: 'Poppins', sans-serif;
                background: linear-gradient(135deg, #f5f7fa 0%, #f8e9e9 100%);
                color: var(--dark);
                overflow-x: hidden;
                line-height: 1.6;
                min-height: 100vh;
                padding: 20px;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
            }

            /* Language Switcher - Enhanced */
            .language-switcher {
                position: fixed;
                top: 10px;
                left: 10px;
                z-index: 1000;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 50px;
                padding: 8px 12px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                backdrop-filter: blur(10px);
                border: 2px solid rgba(212, 175, 55, 0.3);
                display: flex;
                align-items: center;
                gap: 8px;
                transition: all 0.4s ease;
            }

            .language-switcher:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
            }

            .lang-btn {
                background: transparent;
                border: 2px solid var(--secondary);
                color: var(--dark);
                padding: 6px 12px;
                border-radius: 25px;
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: 600;
                font-size: 0.85rem;
                position: relative;
                overflow: hidden;
            }

            .lang-btn.active {
                background: var(--secondary);
                color: white;
                box-shadow: 0 0 15px rgba(212, 175, 55, 0.7);
                transform: scale(1.05);
            }

            .lang-btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
                transition: all 0.5s ease;
            }

            .lang-btn:hover::before {
                left: 100%;
            }

            .lang-btn:hover {
                transform: scale(1.05);
            }

            /* Music Player */
            .music-player {
                position: fixed;
                top: 10px;
                right: 10px;
                z-index: 1000;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 50px;
                padding: 8px 12px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                backdrop-filter: blur(10px);
                border: 2px solid rgba(212, 175, 55, 0.3);
                display: flex;
                align-items: center;
                gap: 8px;
                transition: all 0.4s ease;
            }

            .music-player.playing {
                border-color: rgba(212, 175, 55, 0.7);
                box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
            }

            .music-toggle {
                background: linear-gradient(135deg, var(--secondary), #b8941f);
                color: white;
                border: none;
                border-radius: 50%;
                width: 35px;
                height: 35px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                box-shadow: 0 2px 8px rgba(212, 175, 55, 0.4);
                font-size: 0.9rem;
            }

            .music-toggle:hover {
                transform: scale(1.1);
                box-shadow: 0 4px 12px rgba(212, 175, 55, 0.6);
            }

            .music-text {
                font-size: 0.8rem;
                color: var(--dark);
                font-weight: 600;
                letter-spacing: 0.5px;
            }

            .music-loading {
                display: none;
                font-size: 0.7rem;
                color: var(--accent);
                font-style: italic;
            }

            /* Header Section */
            header {
                text-align: center;
                padding: 40px 15px;
                background: linear-gradient(rgba(58, 44, 44, 0.85), rgba(58, 44, 44, 0.85)), 
                            url('https://images.unsplash.com/photo-1519225421980-715cb0215aed?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
                background-size: cover;
                background-position: center;
                color: white;
                border-radius: 15px;
                margin-bottom: 30px;
                position: relative;
                overflow: hidden;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            }

            .magic-particles {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 1;
            }

            .particle {
                position: absolute;
                width: 4px;
                height: 4px;
                background: var(--secondary);
                border-radius: 50%;
                opacity: 0;
                animation: float 15s infinite linear;
                box-shadow: var(--gold-glow);
            }

            @keyframes float {
                0% {
                    transform: translateY(100vh) rotate(0deg);
                    opacity: 0;
                }
                10% {
                    opacity: 1;
                }
                90% {
                    opacity: 1;
                }
                100% {
                    transform: translateY(-100px) rotate(360deg);
                    opacity: 0;
                }
            }

            .couple-names {
                font-family: 'Dancing Script', cursive;
                font-size: 3.5rem;
                margin-bottom: 15px;
                text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
                position: relative;
                z-index: 2;
                background: linear-gradient(to right, #d4af37, #f8e9e9, #d4af37);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                animation: nameGlow 3s ease-in-out infinite alternate;
            }

            .couple-names.arabic {
                font-family: 'Amiri', serif;
                font-size: 3.5rem;
                background: linear-gradient(to right, #d4af37, #f8e9e9, #d4af37, #f8e9e9, #d4af37);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                text-shadow: 0 0 15px rgba(212, 175, 55, 0.7), 0 0 30px rgba(212, 175, 55, 0.5);
                position: relative;
                letter-spacing: 2px;
                line-height: 1.4;
            }

            @keyframes nameGlow {
                0% {
                    text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
                }
                100% {
                    text-shadow: 0 0 20px rgba(212, 175, 55, 0.8), 0 0 30px rgba(212, 175, 55, 0.6);
                }
            }

            .wedding-date {
                font-family: 'Playfair Display', serif;
                font-size: 1.5rem;
                margin-bottom: 20px;
                letter-spacing: 2px;
                position: relative;
                z-index: 2;
                color: var(--secondary);
            }

            .wedding-date.arabic {
                font-family: 'Amiri', serif;
                letter-spacing: 0;
                font-size: 1.8rem;
                text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
                line-height: 1.6;
            }

            .countdown {
                display: flex;
                justify-content: center;
                gap: 10px;
                margin: 25px 0;
                position: relative;
                z-index: 2;
            }

            .countdown-item {
                background: rgba(255, 255, 255, 0.15);
                padding: 12px;
                border-radius: 10px;
                min-width: 70px;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }

            .countdown-item:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            }

            .countdown-number {
                font-size: 1.8rem;
                font-weight: 700;
                display: block;
                color: var(--secondary);
                text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }

            .countdown-label {
                font-size: 0.8rem;
                text-transform: uppercase;
                letter-spacing: 1px;
                color: rgba(255, 255, 255, 0.9);
            }

            .invitation-text {
                font-size: 1rem;
                max-width: 600px;
                margin: 0 auto;
                line-height: 1.6;
                position: relative;
                z-index: 2;
            }

            .invitation-text.arabic {
                font-family: 'Amiri', serif;
                direction: rtl;
                font-size: 1.2rem;
                text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
                line-height: 1.8;
            }

            /* Location Section */
            .location-section {
                background: white;
                padding: 30px 15px;
                margin-bottom: 20px;
                border-radius: 15px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
                position: relative;
                overflow: hidden;
                background: linear-gradient(135deg, #fffaf0 0%, #ffffff 100%);
            }

            .location-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 25px;
                max-width: 100%;
                margin: 0 auto;
            }

            .location-content {
                flex: 1;
                width: 100%;
                text-align: center;
            }

            .location-title {
                font-family: 'Playfair Display', serif;
                font-size: 1.8rem;
                margin-bottom: 20px;
                color: var(--dark);
                position: relative;
            }

            .location-title.arabic {
                font-family: 'Amiri', serif;
                direction: rtl;
                font-size: 2.2rem;
                background: linear-gradient(to right, #d4af37, #3a2c2c, #d4af37);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                line-height: 1.6;
            }

            .location-title:after {
                content: '';
                display: block;
                width: 80px;
                height: 2px;
                background: var(--secondary);
                margin: 12px auto;
            }

            .magic-card {
                background: linear-gradient(120deg, #ffffff, #f8f4f4);
                padding: 25px;
                border-radius: 15px;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
                border: 1px solid rgba(212, 175, 55, 0.2);
                position: relative;
                transition: transform 0.4s ease, box-shadow 0.4s ease;
            }

            .magic-card:hover {
                transform: translateY(-8px);
                box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15), var(--gold-glow);
            }

            .event-icon {
                font-size: 2.5rem;
                color: var(--secondary);
                margin-bottom: 20px;
                text-shadow: var(--gold-glow);
                animation: ringPulse 2s infinite;
            }

            @keyframes ringPulse {
                0% {
                    transform: scale(1) rotate(0deg);
                }
                50% {
                    transform: scale(1.1) rotate(5deg);
                }
                100% {
                    transform: scale(1) rotate(0deg);
                }
            }

            .event-title {
                font-family: 'Playfair Display', serif;
                font-size: 1.5rem;
                margin-bottom: 15px;
                color: var(--dark);
            }

            .event-title.arabic {
                font-family: 'Amiri', serif;
                direction: rtl;
                font-size: 1.8rem;
                line-height: 1.6;
            }

            .event-details {
                font-size: 1rem;
                margin-bottom: 20px;
                line-height: 1.6;
            }

            .event-details.arabic {
                font-family: 'Amiri', serif;
                direction: rtl;
                font-size: 1.2rem;
                line-height: 1.8;
            }

            .event-details p {
                margin-bottom: 8px;
            }

            .location-link {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                color: black;
                text-decoration: none;
                font-weight: bold;
                margin-top: 12px;
                padding: 10px 20px;
                border: 2px solid var(--accent);
                border-radius: 50px;
                transition: all 0.3s ease;
                font-size: 1rem;
            }

            .location-link:hover {
                background: var(--accent);
                color: white;
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(200, 155, 123, 0.4);
            }

            .location-image {
                width: 100%;
                height: 250px;
                background: url('https://images.unsplash.com/photo-1519225421980-715cb0215aed?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
                background-size: cover;
                background-position: center;
                border-radius: 10px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
                position: relative;
                overflow: hidden;
                animation: floatImage 6s ease-in-out infinite;
            }

            @keyframes floatImage {
                0% { transform: translateY(0px); }
                50% { transform: translateY(-10px); }
                100% { transform: translateY(0px); }
            }

            .location-image:before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(45deg, rgba(212, 175, 55, 0.2), rgba(200, 155, 123, 0.2));
                z-index: 1;
            }

            /* View Messages Button - Enhanced */
            .view-messages-btn {
                display: none;
                background: linear-gradient(135deg, var(--secondary), #b8941f);
                color: white;
                border: none;
                border-radius: 50px;
                padding: 15px 30px;
                font-family: 'Poppins', sans-serif;
                font-size: 1.1rem;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
                margin: 30px auto;
                position: relative;
                overflow: hidden;
                text-align: center;
                width: auto;
                min-width: 200px;
                z-index: 10;
            }

            .view-messages-btn.arabic {
                font-family: 'Amiri', serif;
                font-size: 1.3rem;
                line-height: 1.6;
            }

            .view-messages-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 6px 20px rgba(212, 175, 55, 0.6);
                background: linear-gradient(135deg, #b8941f, var(--secondary));
            }

            .view-messages-btn i {
                margin-left: 10px;
                transition: transform 0.3s ease;
            }

            .view-messages-btn.arabic i {
                margin-left: 0;
                margin-right: 10px;
            }

            .view-messages-btn:hover i {
                transform: translateY(3px);
            }

            /* Magical Message Gallery Styles - Enhanced */
            .magic-message-gallery {
                display: none;
                margin: 40px 0;
                padding: 30px 15px;
                background: white;
                border-radius: 15px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
                background: linear-gradient(135deg, #fffaf0 0%, #ffffff 100%);
                position: relative;
                overflow: hidden;
                animation: fadeInGallery 0.8s ease forwards;
            }

            @keyframes fadeInGallery {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }

            .magic-message-gallery::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: url('https://images.unsplash.com/photo-1519225421980-715cb0215aed?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
                background-size: cover;
                background-position: center;
                opacity: 0.05;
                z-index: 0;
            }

            .magic-message-title {
                font-family: 'Playfair Display', serif;
                font-size: 1.8rem;
                text-align: center;
                margin-bottom: 30px;
                color: var(--dark);
                position: relative;
                z-index: 1;
            }

            .magic-message-title.arabic {
                font-family: 'Amiri', serif;
                direction: rtl;
                font-size: 2.2rem;
                line-height: 1.6;
            }

            .magic-message-title:after {
                content: '';
                display: block;
                width: 80px;
                height: 2px;
                background: var(--secondary);
                margin: 12px auto;
            }

            .magic-message-container {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 20px;
                margin-top: 20px;
                position: relative;
                z-index: 1;
            }

            .magic-message-box {
                background: linear-gradient(135deg, #fffaf0, #f8f4f4);
                border-radius: 15px;
                padding: 20px;
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
                border: 1px solid rgba(212, 175, 55, 0.2);
                transition: transform 0.3s ease, box-shadow 0.3s ease;
                position: relative;
                overflow: hidden;
                animation: fadeInUp 0.6s ease forwards;
                opacity: 0;
                transform: translateY(20px);
            }

            .magic-message-box:hover {
                transform: translateY(-5px);
                box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15), var(--gold-glow);
            }

            .magic-message-box::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 4px;
                background: linear-gradient(to right, var(--secondary), var(--accent));
            }

            .magic-message-box::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, rgba(212, 175, 55, 0.05), rgba(200, 155, 123, 0.05));
                z-index: -1;
            }

            .magic-message-author {
                font-weight: bold;
                color: var(--dark);
                margin-bottom: 10px;
                font-size: 1.1rem;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .magic-message-author.arabic {
                direction: rtl;
                font-family: 'Amiri', serif;
                font-size: 1.2rem;
                line-height: 1.6;
            }

            .magic-message-author i {
                color: var(--secondary);
            }

            .magic-message-content {
                color: var(--dark);
                line-height: 1.6;
                font-size: 0.95rem;
                position: relative;
            }

            .magic-message-content.arabic {
                direction: rtl;
                text-align: right;
                font-family: 'Amiri', serif;
                font-size: 1.1rem;
                line-height: 1.8;
            }

            .magic-message-date {
                font-size: 0.8rem;
                color: var(--accent);
                margin-top: 10px;
                text-align: right;
            }

            .magic-message-date.arabic {
                direction: rtl;
                text-align: left;
                font-family: 'Amiri', serif;
            }

            .magic-message-star {
                position: absolute;
                top: 10px;
                right: 10px;
                color: var(--secondary);
                font-size: 0.9rem;
                animation: twinkle 2s infinite;
            }

            @keyframes twinkle {
                0% { opacity: 0.5; transform: scale(1); }
                50% { opacity: 1; transform: scale(1.2); }
                100% { opacity: 0.5; transform: scale(1); }
            }

            @keyframes fadeInUp {
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .no-messages {
                text-align: center;
                padding: 40px;
                color: var(--accent);
                font-style: italic;
                grid-column: 1 / -1;
            }

            .no-messages.arabic {
                font-family: 'Amiri', serif;
                direction: rtl;
                font-size: 1.2rem;
                line-height: 1.8;
            }

            /* Message Form */
            .message-form {
                max-width: 600px;
                margin: 0 auto;
                background: white;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
                margin-top: 40px;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-group label {
                display: block;
                margin-bottom: 8px;
                font-weight: 500;
                font-size: 1rem;
            }

            .form-group.arabic {
                direction: rtl;
                text-align: right;
            }

            .form-group.arabic label {
                font-family: 'Amiri', serif;
                font-size: 1.2rem;
                line-height: 1.6;
            }

            .form-control {
                width: 100%;
                padding: 12px 15px;
                border: 1px solid #ddd;
                border-radius: 8px;
                font-family: 'Poppins', sans-serif;
                font-size: 0.95rem;
                transition: all 0.3s ease;
                background: #f9f9f9;
            }

            .form-control.arabic {
                font-family: 'Amiri', serif;
                direction: rtl;
                text-align: right;
                font-size: 1.1rem;
                line-height: 1.6;
            }

            .form-control:focus {
                border-color: var(--secondary);
                outline: none;
                box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
                background: white;
            }

            .btn {
                display: inline-block;
                background: linear-gradient(135deg, var(--secondary), #b8941f);
                color: white;
                padding: 12px 25px;
                border: none;
                border-radius: 50px;
                font-family: 'Poppins', sans-serif;
                font-size: 1rem;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
                width: 100%;
            }

            .btn.arabic {
                font-family: 'Amiri', serif;
                font-size: 1.2rem;
                line-height: 1.6;
            }

            .btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 6px 15px rgba(212, 175, 55, 0.6);
                background: linear-gradient(135deg, #b8941f, var(--secondary));
            }

            .btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none;
            }

            /* Success/Error Messages */
            .success-message {
                background: #d4edda;
                color: #155724;
                padding: 12px;
                border-radius: 8px;
                margin: 15px 0;
                text-align: center;
                border: 1px solid #c3e6cb;
                display: none;
            }

            .error-message {
                background: #f8d7da;
                color: #721c24;
                padding: 12px;
                border-radius: 8px;
                margin: 15px 0;
                text-align: center;
                border: 1px solid #f5c6cb;
                display: none;
            }

            /* Footer */
            footer {
                text-align: center;
                padding: 25px 15px;
                background: var(--dark);
                color: white;
                border-radius: 10px;
                margin-top: 25px;
                position: relative;
                overflow: hidden;
            }

            .footer-text {
                font-family: 'Dancing Script', cursive;
                font-size: 1.5rem;
                margin-bottom: 15px;
                color: var(--secondary);
            }

            .footer-text.arabic {
                font-family: 'Amiri', serif;
                font-size: 1.8rem;
                background: linear-gradient(to right, #d4af37, #f8e9e9, #d4af37);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                line-height: 1.6;
            }

            /* Magic Elements */
            .floating-hearts {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: -1;
            }

            .heart {
                position: absolute;
                font-size: 16px;
                color: rgba(212, 175, 55, 0.15);
                animation: float-heart 15s infinite linear;
            }

            @keyframes float-heart {
                0% {
                    transform: translateY(100vh) rotate(0deg);
                    opacity: 0;
                }
                10% {
                    opacity: 0.5;
                }
                90% {
                    opacity: 0.5;
                }
                100% {
                    transform: translateY(-100px) rotate(360deg);
                    opacity: 0;
                }
            }

            /* Section Title */
            .section-title {
                font-family: 'Playfair Display', serif;
                font-size: 1.8rem;
                text-align: center;
                margin: 30px 0 15px;
                color: var(--dark);
                position: relative;
            }

            .section-title:after {
                content: '';
                display: block;
                width: 80px;
                height: 2px;
                background: var(--secondary);
                margin: 12px auto;
            }

            /* Special hearts for form submission */
            .celebration-hearts {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 1000;
            }

            .celebration-heart {
                position: absolute;
                font-size: 24px;
                color: rgba(212, 175, 55, 0.8);
                animation: celebration-float 3s ease-out forwards;
                z-index: 1001;
            }

            @keyframes celebration-float {
                0% {
                    transform: translateY(0) scale(1);
                    opacity: 1;
                }
                100% {
                    transform: translateY(-100px) scale(1.5);
                    opacity: 0;
                }
            }

            /* Enhanced View Messages Animation */
            .magic-glow {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: radial-gradient(circle, rgba(212,175,55,0.2) 0%, rgba(212,175,55,0) 70%);
                z-index: -1;
                opacity: 0;
                transition: opacity 0.5s ease;
            }

            .magic-message-gallery.active .magic-glow {
                opacity: 1;
            }

            /* ---------------------------------------------------- */
            /* Magical Door Styles */
            /* ---------------------------------------------------- */
            #door-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: var(--dark); /* Dark background while doors are closed */
                z-index: 9999; /* Ensure it covers everything */
                display: flex;
                justify-content: center;
                align-items: center;
                overflow: hidden;
                opacity: 1;
                transition: opacity 1.5s ease-out; /* Fade out transition */
            }

            .left-door, .right-door {
                position: absolute;
                top: 0;
                width: 50%;
                height: 100%;
                background: #5c3b2e; /* Wood color */
                border: 15px solid #3d271f;
                transition: transform 1.5s cubic-bezier(0.5, 0, 0.5, 1); /* Smooth, dramatic slide */
                box-shadow: 0 0 50px rgba(0, 0, 0, 0.8) inset;
                display: flex;
                flex-direction: column;
                justify-content: space-around;
                padding: 50px 0;
            }

            .left-door {
                left: 0;
                border-right: none;
                transform-origin: right;
                border-top-right-radius: 5px;
                border-bottom-right-radius: 5px;
            }

            .right-door {
                right: 0;
                border-left: none;
                transform-origin: left;
                border-top-left-radius: 5px;
                border-bottom-left-radius: 5px;
            }
            
            /* Door Planks & Accents */
            .left-door::before, .right-door::before {
                content: '';
                position: absolute;
                top: 0;
                width: 100%;
                height: 100%;
                background-image: repeating-linear-gradient(to right, #4b3024, #4b3024 100px, #5c3b2e 100px, #5c3b2e 110px);
                opacity: 0.8;
                mix-blend-mode: multiply;
            }

            .left-door::after, .right-door::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(180deg, rgba(212, 175, 55, 0.2) 0%, rgba(200, 155, 123, 0.1) 50%, rgba(212, 175, 55, 0.2) 100%);
                z-index: 1;
            }

            /* Gold Hinges/Accents */
            .hinge-top, .hinge-bottom {
                width: 80%;
                height: 15px;
                background: var(--secondary); /* Gold color */
                margin: 0 auto;
                border-radius: 5px;
                box-shadow: var(--gold-glow), 0 5px 10px rgba(0, 0, 0, 0.5);
                position: relative;
                z-index: 2;
            }

            /* Open Door Class */
            .left-door.open {
                transform: translateX(-100%);
            }

            .right-door.open {
                transform: translateX(100%);
            }

            /* Open Door Button */
            .open-door-btn {
                position: absolute;
                z-index: 10000;
                padding: 20px 40px;
                background: linear-gradient(135deg, var(--secondary), #b8941f);
                color: white;
                border: 4px solid white;
                border-radius: 50px;
                font-size: 1.5rem;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 0 25px rgba(212, 175, 55, 0.9), 0 5px 20px rgba(0, 0, 0, 0.5);
                font-family: 'Playfair Display', serif;
                letter-spacing: 1px;
            }
            
            .open-door-btn.arabic {
                font-family: 'Amiri', serif;
            }

            .open-door-btn:hover {
                transform: scale(1.05) translateY(-2px);
                box-shadow: 0 0 35px rgba(212, 175, 55, 1), 0 8px 30px rgba(0, 0, 0, 0.7);
            }
            
            .open-door-btn i {
                margin-right: 10px;
            }
            
            /* Door Title/Text */
            .door-text {
                position: absolute;
                top: 10%;
                color: white;
                font-size: 3rem;
                font-family: 'Dancing Script', cursive;
                text-shadow: 0 0 20px var(--secondary), 0 0 10px black;
                z-index: 10000;
            }
            
            .door-text-arabic {
                position: absolute;
                top: 10%;
                color: white;
                font-size: 3rem;
                font-family: 'Amiri', serif;
                text-shadow: 0 0 20px var(--secondary), 0 0 10px black;
                z-index: 10000;
                display: none; /* Only visible when language is 'ar' */
            }
            
            /* Scroll Prompt (Hidden until doors open) */
            .scroll-prompt {
                position: absolute;
                bottom: 20px;
                color: white;
                font-size: 1.2rem;
                z-index: 10000;
                display: none;
                animation: bounce 2s infinite;
            }
            
            @keyframes bounce {
                0%, 20%, 50%, 80%, 100% {
                    transform: translateY(0);
                }
                40% {
                    transform: translateY(-10px);
                }
                60% {
                    transform: translateY(-5px);
                }
            }
            
            /* Ensure main content is initially hidden and fades in */
            .container, header, .location-section, #messages, footer {
                opacity: 0;
                transition: opacity 1.5s ease-in 1.5s; /* Delay fade-in until after door animation */
            }
            
            .page-visible .container, 
            .page-visible header, 
            .page-visible .location-section, 
            .page-visible #messages, 
            .page-visible footer {
                opacity: 1;
            }

            /* Responsive */
            @media (min-width: 768px) {
                .couple-names {
                    font-size: 5rem;
                }
                
                .couple-names.arabic {
                    font-size: 4.5rem;
                }
                
                .wedding-date {
                    font-size: 2rem;
                }
                
                .countdown {
                    gap: 20px;
                }
                
                .countdown-item {
                    min-width: 110px;
                    padding: 20px;
                }
                
                .countdown-number {
                    font-size: 2.8rem;
                }
                
                .countdown-label {
                    font-size: 1rem;
                }
                
                .location-container {
                    flex-direction: row;
                    gap: 50px;
                }
                
                .location-content {
                    width: auto;
                }
                
                .location-image {
                    width: auto;
                    height: 450px;
                }
                
                .btn {
                    width: auto;
                }
                
                .view-messages-btn {
                    width: auto;
                    padding: 15px 40px;
                    font-size: 1.2rem;
                }
                
                .music-text {
                    display: inline;
                }
                
                /* Responsive adjustments for door text */
                .door-text, .door-text-arabic {
                    font-size: 3rem;
                    top: 10%;
                }
                .open-door-btn {
                    padding: 20px 40px;
                    font-size: 1.5rem;
                }
            }

            @media (max-width: 768px) {
                /* Responsive adjustments for door text */
                .door-text, .door-text-arabic {
                    font-size: 2rem;
                    top: 5%;
                }
                .open-door-btn {
                    padding: 15px 30px;
                    font-size: 1.2rem;
                }
            }
            
            @media (max-width: 480px) {
                .couple-names {
                    font-size: 2rem;
                }
                
                .couple-names.arabic {
                    font-size: 2.2rem;
                }
                
                .countdown {
                    flex-wrap: wrap;
                }
                
                .countdown-item {
                    min-width: 65px;
                    padding: 10px;
                }
                
                .countdown-number {
                    font-size: 1.5rem;
                }
                
                .music-text {
                    display: none;
                }
                
                .view-messages-btn {
                    width: 100%;
                    padding: 12px 20px;
                }
            }
        </style>
    </head>
    <body>
        <div id="door-overlay">
            <div class="door-text" id="door-title">Welcome to Our Magical Wedding</div>
            <div class="door-text-arabic" id="door-title-arabic">مرحباً بكم في حفل زفافنا السحري</div>
            <div class="left-door" id="left-door">
                <div class="hinge-top"></div>
                <div class="hinge-bottom"></div>
            </div>
            <div class="right-door" id="right-door">
                <div class="hinge-top"></div>
                <div class="hinge-bottom"></div>
            </div>
            <button class="open-door-btn" id="openDoorBtn">
                <i class="fas fa-hand-pointer"></i> <span id="openDoorText">Tap to Enter</span>
            </button>
            <div class="scroll-prompt" id="scrollPrompt">
                <i class="fas fa-chevron-down"></i> <span id="scrollText">Scroll Down</span>
            </div>
        </div>
        <div class="language-switcher">
            <button class="lang-btn active" id="langEn">EN</button>
            <button class="lang-btn" id="langAr">ع</button>
        </div>

        <div class="music-player" id="musicPlayer">
            <button class="music-toggle" id="musicToggle">
                <i class="fas fa-volume-up"></i>
            </button>
            <span class="music-text" id="musicText">Wedding Music</span>
            <span class="music-loading" id="musicLoading">Loading...</span>
        </div>

        <div class="floating-hearts" id="hearts-container"></div>
        
        <div class="celebration-hearts" id="celebration-hearts"></div>

        <div class="container">
            <header>
                <div class="magic-particles" id="particles-container"></div>
                <h1 class="couple-names" id="coupleNames">Mohamed & Kholoud</h1>
                <p class="wedding-date" id="weddingDate">7th December, 2025</p>
                
                <div class="countdown">
                    <div class="countdown-item">
                        <span class="countdown-number" id="days">00</span>
                        <span class="countdown-label" id="daysLabel">Days</span>
                    </div>
                    <div class="countdown-item">
                        <span class="countdown-number" id="hours">00</span>
                        <span class="countdown-label" id="hoursLabel">Hours</span>
                    </div>
                    <div class="countdown-item">
                        <span class="countdown-number" id="minutes">00</span>
                        <span class="countdown-label" id="minutesLabel">Minutes</span>
                    </div>
                    <div class="countdown-item">
                        <span class="countdown-number" id="seconds">00</span>
                        <span class="countdown-label" id="secondsLabel">Seconds</span>
                    </div>
                </div>
                
                <p class="invitation-text" id="invitationText">With immense joy and love, we invite you to witness and celebrate our union as we begin our journey together as husband and wife.</p>
            </header>

            <section class="location-section">
                <div class="location-container">
                    <div class="location-content">
                        <h2 class="location-title" id="locationTitle">Our Wedding Celebration</h2>
                        <div class="magic-card">
                            <div class="event-icon">
                                <i class="fas fa-ring"></i>
                            </div>
                            <h3 class="event-title" id="ceremonyTitle">Wedding Ceremony</h3>
                            <div class="event-details" id="eventDetails">
                                <p><strong id="dateLabel">Date:</strong> December 7, 2025</p>
                                <p><strong id="timeLabel">Time:</strong> 7:00 PM</p>
                                <p><strong id="locationLabel">Location:</strong> RIONA </p>
                                <p>Madinet Dekernes, Dakahlia Governorate 7820222</p>
                            </div>
                            <a href="https://www.google.com/maps/dir/30.1308783,31.3481522/31.071096,31.6044038/@30.5872623,30.7391794,9z/data=!3m1!4b1!4m4!4m3!1m1!4e1!1m0?entry=ttu&g_ep=EgoyMDI5MTAxMy4wIKXMDSoASAFQAw%3D%3D" target="_blank" class="location-link">
                                <i class="fas fa-map-marker-alt"></i> <span id="mapText">View on Google Maps</span>
                            </a>
                        </div>
                    </div>
                    <div class="location-image"></div>
                </div>
            </section>

            <div style="text-align: center;">
                <button class="view-messages-btn" id="viewMessagesBtn">
                    <span id="viewMessagesText">View Messages</span>
                    <i class="fas fa-arrow-down"></i>
                </button>
            </div>

            <section class="magic-message-gallery" id="magicMessageGallery">
                <div class="magic-glow"></div>
                <h2 class="magic-message-title" id="magicMessageGalleryTitle">Messages from Our Loved Ones</h2>
                <div class="magic-message-container" id="magicMessageContainer">
                    </div>
            </section>

            <section id="messages">
                <h2 class="section-title" id="wishesTitle">Send Your Wishes</h2>
                <p style="text-align: center; margin-bottom: 20px;" id="wishesSubtitle">Share your congratulations and message for our special day</p>
                
                <div class="success-message" id="successMessage"></div>
                <div class="error-message" id="errorMessage"></div>
                
                <form class="message-form" id="messageForm">
                    <div class="form-group" id="nameGroup">
                        <label for="name" id="nameLabel">Full Name</label>
                        <input type="text" id="name" class="form-control" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group" id="messageGroup">
                        <label for="message" id="messageLabel">Your Message</label>
                        <textarea id="message" class="form-control" rows="4" placeholder="Write your congratulations message here..." required></textarea>
                    </div>
                    <button type="submit" class="btn" id="submitBtn">
                        <span id="submitText">Send Message</span>
                        <span id="loadingText" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i> Sending...
                        </span>
                    </button>
                </form>
            </section>

            <footer>
                <p class="footer-text" id="footerLove">With love, Mohamed & Kholoud</p>
                <p id="footerCopyright">© 2025 | Made with ❤️ for our special day</p>
            </footer>
        </div>

        <audio id="backgroundMusic" loop>
            </audio>

        <script>
            // Language Content
            const content = {
                en: {
                    // NEW DOOR TEXT
                    doorTitle: "Welcome to Our Magical Wedding",
                    openDoorText: "Tap to Enter",
                    scrollText: "Scroll Down",
                    // END NEW DOOR TEXT
                    coupleNames: "Mohamed & Kholoud",
                    weddingDate: "7th December, 2025",
                    daysLabel: "Days",
                    hoursLabel: "Hours", 
                    minutesLabel: "Minutes",
                    secondsLabel: "Seconds",
                    invitationText: "With immense joy and love, we invite you to witness and celebrate our union as we begin our journey together as husband and wife.",
                    locationTitle: "Our Wedding Celebration",
                    ceremonyTitle: "Wedding Ceremony",
                    dateLabel: "Date:",
                    timeLabel: "Time:",
                    locationLabel: "Location:",
                    eventDetails: "<p><strong>Date:</strong> December 7, 2025</p><p><strong>Time:</strong> 7:00 PM</p><p><strong>Location:</strong> RIONA</p><p>Madinet Dekernes, Dakahlia Governorate 7820222</p>",
                    mapText: "View on Google Maps",
                    wishesTitle: "Send Your Wishes",
                    wishesSubtitle: "Share your congratulations and message for our special day",
                    nameLabel: "Full Name",
                    namePlaceholder: "Enter your full name",
                    messageLabel: "Your Message",
                    messagePlaceholder: "Write your congratulations message here...",
                    submitBtn: "Send Message",
                    footerLove: "With love, Mohamed & Kholoud",
                    footerCopyright: "© 2025 | Made with ❤️ for our special day",
                    musicText: "Wedding Music",
                    clickToPlay: "Click to play music",
                    successMessage: "Thank you! Your message has been saved successfully!",
                    errorMessage: "Sorry, there was an error sending your message. Please try again.",
                    viewMessagesText: "View Messages",
                    magicMessageGalleryTitle: "Messages from Our Loved Ones",
                    noMessagesText: "No messages yet. Be the first to send your wishes!"
                },
                ar: {
                    // NEW DOOR TEXT
                    doorTitle: "مرحباً بكم في حفل زفافنا السحري",
                    openDoorText: "انقر للدخول",
                    scrollText: "مرر للأسفل",
                    // END NEW DOOR TEXT
                    coupleNames: "محمد و خلود",
                    weddingDate: "٧ ديسمبر ٢٠٢٥",
                    daysLabel: "أيام",
                    hoursLabel: "ساعات",
                    minutesLabel: "دقائق", 
                    secondsLabel: "ثواني",
                    invitationText: "بكل فرح وحب، ندعوكم لمشاركتنا فرحة زفافنا والاحتفال ببداية رحلتنا معًا كزوج وزوجة.",
                    locationTitle: "احتفال زفافنا",
                    ceremonyTitle: "حفل الزفاف",
                    dateLabel: "التاريخ:",
                    timeLabel: "الوقت:",
                    locationLabel: "المكان:",
                    eventDetails: "<p><strong>التاريخ:</strong> ٧ ديسمبر ٢٠٢٥</p><p><strong>الوقت:</strong> ٧:٠٠ مساءً</p><p><strong>المكان:</strong> قاعة ريونا</p><p> مدينة دكرنس  ,  محافظة الدقهلية</p>",
                    mapText: "عرض على خرائط جوجل",
                    wishesTitle: "أرسل تهنئتك",
                    wishesSubtitle: "شاركنا تهنئتك ورسالتك في يومنا السعيد",
                    nameLabel: "الاسم الكامل",
                    namePlaceholder: "أدخل اسمك الكامل",
                    messageLabel: "رسالتك",
                    messagePlaceholder: "اكتب رسالة التهنئة هنا...",
                    submitBtn: "إرسال الرسالة",
                    footerLove: "بكل حب، محمد و خلود",
                    footerCopyright: "© ٢٠٢٥ | صنع من أجل يومنا الخاص ❤️",
                    musicText: "موسيقى الزفاف",
                    clickToPlay: "انقر لتشغيل الموسيقى",
                    successMessage: "شكراً لك! تم حفظ رسالتك بنجاح!",
                    errorMessage: "عذراً، حدث خطأ في إرسال رسالتك. يرجى المحاولة مرة أخرى.",
                    viewMessagesText: "عرض الرسائل",
                    magicMessageGalleryTitle: "رسائل من أحبائنا",
                    noMessagesText: "لا توجد رسائل حتى الآن. كن أول من يرسل تهنئته!"
                }
            };

            let currentLang = 'en';
            let flaggedMessagesExist = false;

            // Music files array
            const musicFiles = [
                'wedding-music-1.mp3',
                'wedding-music-2.mp3',
                'wedding-music-3.mp3'
            ];

            // Function to get a random music file
            function getRandomMusicFile() {
                const randomIndex = Math.floor(Math.random() * musicFiles.length);
                return musicFiles[randomIndex];
            }

            // Initialize audio with a random file
            function initAudio() {
                const randomMusicFile = getRandomMusicFile();
                console.log("Loading random music file:", randomMusicFile);
                
                const backgroundMusic = document.getElementById('backgroundMusic');
                backgroundMusic.innerHTML = ''; // Clear any existing sources
                
                const source = document.createElement('source');
                source.src = randomMusicFile;
                source.type = 'audio/mpeg';
                backgroundMusic.appendChild(source);
                
                backgroundMusic.load();
                backgroundMusic.volume = 0.7;
                
                console.log("Audio initialized with: " + randomMusicFile);
            }

            // Firebase Message Storage
            async function saveMessageToFirebase(name, message) {
                try {
                    const { collection, addDoc, serverTimestamp } = window.firebaseModules;
                    
                    const messageData = {
                        name: name,
                        message: message,
                        timestamp: serverTimestamp(),
                        language: currentLang,
                        wedding: 'mohamed-kholoud',
                        flagged: false // Default to false
                    };

                    const docRef = await addDoc(collection(window.firestore, 'weddingMessages'), messageData);
                    console.log("Message saved with ID: " + docRef.id);
                    return true;
                } catch (error) {
                    console.error("Error saving message: " + error);
                    return false;
                }
            }

            // Check if flagged messages exist
            async function checkFlaggedMessages() {
                try {
                    console.log("Checking for flagged messages...");
                    
                    const { collection, getDocs } = window.firebaseModules;
                    
                    const messagesQuery = collection(window.firestore, 'weddingMessages');
                    const querySnapshot = await getDocs(messagesQuery);
                    
                    // Filter manually to avoid index requirement
                    const flaggedMessages = [];
                    querySnapshot.forEach((doc) => {
                        const messageData = doc.data();
                        if (messageData.flagged === true) {
                            flaggedMessages.push({ id: doc.id, ...messageData });
                        }
                    });
                    
                    console.log("Found " + flaggedMessages.length + " flagged messages");
                    
                    flaggedMessagesExist = flaggedMessages.length > 0;
                    
                    // Show/hide the view messages button based on flagged messages
                    const viewMessagesBtn = document.getElementById('viewMessagesBtn');
                    if (flaggedMessagesExist) {
                        viewMessagesBtn.style.display = 'block';
                        console.log("Showing view messages button");
                    } else {
                        viewMessagesBtn.style.display = 'none';
                        console.log("Hiding view messages button - no flagged messages");
                    }
                    
                    return flaggedMessagesExist;
                } catch (error) {
                    console.error("Error checking flagged messages: " + error);
                    return false;
                }
            }

            // Load ONLY flagged messages for the magical gallery
            async function loadFlaggedMessages() {
                try {
                    console.log("Loading flagged messages for magical gallery...");
                    
                    const { collection, getDocs } = window.firebaseModules;
                    
                    const messagesQuery = collection(window.firestore, 'weddingMessages');
                    const querySnapshot = await getDocs(messagesQuery);
                    const magicMessageContainer = document.getElementById('magicMessageContainer');
                    magicMessageContainer.innerHTML = '';
                    
                    // Filter manually to avoid index requirement
                    const flaggedMessages = [];
                    querySnapshot.forEach((doc) => {
                        const messageData = doc.data();
                        if (messageData.flagged === true) {
                            flaggedMessages.push({ id: doc.id, ...messageData });
                        }
                    });
                    
                    // Sort by timestamp manually
                    flaggedMessages.sort((a, b) => {
                        const timeA = a.timestamp ? a.timestamp.toDate().getTime() : 0;
                        const timeB = b.timestamp ? b.timestamp.toDate().getTime() : 0;
                        return timeB - timeA; // Descending order (newest first)
                    });
                    
                    console.log("Flagged messages found: " + flaggedMessages.length);
                    
                    if (flaggedMessages.length === 0) {
                        const noMessages = document.createElement('div');
                        noMessages.className = `no-messages ${currentLang === 'ar' ? 'arabic' : ''}`;
                        noMessages.textContent = content[currentLang].noMessagesText;
                        magicMessageContainer.appendChild(noMessages);
                        return true;
                    }
                    
                    let messageIndex = 0;
                    flaggedMessages.forEach((messageData) => {
                        console.log("Flagged message data: " + JSON.stringify(messageData));
                        
                        const messageBox = createMagicMessageBox(messageData, messageIndex);
                        magicMessageContainer.appendChild(messageBox);
                        messageIndex++;
                    });
                    
                    console.log("Displayed " + messageIndex + " flagged messages in magical gallery");
                    
                    return true;
                } catch (error) {
                    console.error("Error loading flagged messages: " + error);
                    return false;
                }
            }

            // Create a magical message box element
            function createMagicMessageBox(messageData, index) {
                const messageBox = document.createElement('div');
                messageBox.className = 'magic-message-box';
                messageBox.style.animationDelay = `${index * 0.1}s`;
                
                const star = document.createElement('div');
                star.className = 'magic-message-star';
                star.innerHTML = '<i class="fas fa-star"></i>';
                
                const author = document.createElement('div');
                author.className = `magic-message-author ${messageData.language === 'ar' ? 'arabic' : ''}`;
                author.innerHTML = `<i class="fas fa-user"></i> ${messageData.name}`;
                
                const content = document.createElement('div');
                content.className = `magic-message-content ${messageData.language === 'ar' ? 'arabic' : ''}`;
                content.textContent = messageData.message;
                
                const date = document.createElement('div');
                date.className = `magic-message-date ${messageData.language === 'ar' ? 'arabic' : ''}`;
                
                // Format the date
                if (messageData.timestamp && messageData.timestamp.toDate) {
                    const messageDate = messageData.timestamp.toDate();
                    date.textContent = messageDate.toLocaleDateString(currentLang === 'ar' ? 'ar-EG' : 'en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                } else {
                    date.textContent = 'Recently';
                }
                
                messageBox.appendChild(star);
                messageBox.appendChild(author);
                messageBox.appendChild(content);
                messageBox.appendChild(date);
                
                return messageBox;
            }

            // Form submission with Firebase
            document.getElementById('messageForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const name = document.getElementById('name').value.trim();
                const message = document.getElementById('message').value.trim();
                const submitBtn = document.getElementById('submitBtn');
                const submitText = document.getElementById('submitText');
                const loadingText = document.getElementById('loadingText');
                const successMessage = document.getElementById('successMessage');
                const errorMessage = document.getElementById('errorMessage');

                // Hide previous messages
                successMessage.style.display = 'none';
                errorMessage.style.display = 'none';

                // Show loading state
                submitBtn.disabled = true;
                submitText.style.display = 'none';
                loadingText.style.display = 'inline';

                try {
                    // Wait for Firebase to be ready
                    if (!window.firestore) {
                        throw new Error('Firebase not initialized yet');
                    }

                    // Save to Firebase
                    const saved = await saveMessageToFirebase(name, message);
                    
                    if (saved) {
                        // Show success message
                        successMessage.textContent = content[currentLang].successMessage;
                        successMessage.style.display = 'block';
                        
                        // Create celebration heart animation
                        createCelebrationHearts();
                        
                        // Check for flagged messages to show the view button
                        await checkFlaggedMessages();
                        
                        // Reset form
                        this.reset();
                    } else {
                        throw new Error('Failed to save message');
                    }
                } catch (error) {
                    // Show error message
                    errorMessage.textContent = content[currentLang].errorMessage;
                    errorMessage.style.display = 'block';
                    console.error('Form submission error: ' + error);
                } finally {
                    // Reset button state
                    submitBtn.disabled = false;
                    submitText.style.display = 'inline';
                    loadingText.style.display = 'none';
                }
            });

            // View Messages Button functionality
            document.getElementById('viewMessagesBtn').addEventListener('click', async function() {
                const magicMessageGallery = document.getElementById('magicMessageGallery');
                
                if (magicMessageGallery.style.display === 'none' || magicMessageGallery.style.display === '') {
                    // Load flagged messages and show the magical gallery
                    const loaded = await loadFlaggedMessages();
                    if (loaded) {
                        magicMessageGallery.style.display = 'block';
                        magicMessageGallery.classList.add('active');
                        this.innerHTML = currentLang === 'en' ? 
                            '<span>Hide Messages</span><i class="fas fa-arrow-up"></i>' :
                            '<span>إخفاء الرسائل</span><i class="fas fa-arrow-up"></i>';
                        
                        // Create magical hearts animation when opening messages
                        createMagicalHearts();
                        
                        // Scroll to the message gallery
                        magicMessageGallery.scrollIntoView({ behavior: 'smooth' });
                    }
                } else {
                    // Hide the gallery
                    magicMessageGallery.style.display = 'none';
                    magicMessageGallery.classList.remove('active');
                    this.innerHTML = currentLang === 'en' ? 
                        '<span>View Messages</span><i class="fas fa-arrow-down"></i>' :
                        '<span>عرض الرسائل</span><i class="fas fa-arrow-down"></i>';
                }
            });

            // Create celebration hearts when form is submitted
            function createCelebrationHearts() {
                const celebrationContainer = document.getElementById('celebration-hearts');
                celebrationContainer.innerHTML = ''; // Clear previous hearts
                
                // Create multiple hearts (15-20)
                const heartCount = 15 + Math.floor(Math.random() * 6);
                
                for (let i = 0; i < heartCount; i++) {
                    const heart = document.createElement('div');
                    heart.classList.add('celebration-heart');
                    heart.innerHTML = '❤';
                    
                    // Randomize position and animation
                    const startX = Math.random() * window.innerWidth;
                    const startY = window.innerHeight + 20;
                    const duration = 2 + Math.random() * 2;
                    const delay = Math.random() * 0.5;
                    
                    heart.style.left = startX + 'px';
                    heart.style.top = startY + 'px';
                    heart.style.animationDuration = duration + 's';
                    heart.style.animationDelay = delay + 's';
                    heart.style.color = `rgba(212, 175, 55, ${0.6 + Math.random() * 0.4})`;
                    heart.style.fontSize = (20 + Math.random() * 20) + 'px';
                    
                    celebrationContainer.appendChild(heart);
                    
                    // Remove heart after animation completes
                    setTimeout(() => {
                        if (heart.parentNode) {
                            heart.parentNode.removeChild(heart);
                        }
                    }, (duration + delay) * 1000);
                }
            }

            // Create magical hearts when opening messages
            function createMagicalHearts() {
                const celebrationContainer = document.getElementById('celebration-hearts');
                
                // Create multiple hearts (10-15)
                const heartCount = 10 + Math.floor(Math.random() * 6);
                
                for (let i = 0; i < heartCount; i++) {
                    const heart = document.createElement('div');
                    heart.classList.add('celebration-heart');
                    heart.innerHTML = '❤';
                    
                    // Randomize position and animation
                    const startX = Math.random() * window.innerWidth;
                    const startY = window.innerHeight + 20;
                    const duration = 2 + Math.random() * 2;
                    const delay = Math.random() * 0.5;
                    
                    heart.style.left = startX + 'px';
                    heart.style.top = startY + 'px';
                    heart.style.animationDuration = duration + 's';
                    heart.style.animationDelay = delay + 's';
                    heart.style.color = `rgba(212, 175, 55, ${0.6 + Math.random() * 0.4})`;
                    heart.style.fontSize = (20 + Math.random() * 20) + 'px';
                    
                    celebrationContainer.appendChild(heart);
                    
                    // Remove heart after animation completes
                    setTimeout(() => {
                        if (heart.parentNode) {
                            heart.parentNode.removeChild(heart);
                        }
                    }, (duration + delay) * 1000);
                }
            }
            
            // Door Animation Functionality
            document.getElementById('openDoorBtn').addEventListener('click', function() {
                const leftDoor = document.getElementById('left-door');
                const rightDoor = document.getElementById('right-door');
                const doorOverlay = document.getElementById('door-overlay');
                const openDoorBtn = document.getElementById('openDoorBtn');
                const doorTitle = document.getElementById('door-title');
                const doorTitleArabic = document.getElementById('door-title-arabic');
                const scrollPrompt = document.getElementById('scrollPrompt');
                
                // 1. Open the doors
                leftDoor.classList.add('open');
                rightDoor.classList.add('open');
                
                // 2. Hide button and titles
                openDoorBtn.style.display = 'none';
                if (doorTitle) doorTitle.style.display = 'none';
                if (doorTitleArabic) doorTitleArabic.style.display = 'none';

                // 3. Make the rest of the page visible (fade in)
                document.body.classList.add('page-visible');
                
                // 4. Show scroll prompt and fade out the overlay
                setTimeout(() => {
                    if (scrollPrompt) scrollPrompt.style.display = 'block';
                    
                    // Fade out the overlay completely
                    doorOverlay.style.opacity = '0';
                }, 1000); // Wait for the main part of the door animation
                
                // 5. Remove overlay element completely after fade out
                setTimeout(() => {
                    if (doorOverlay) doorOverlay.style.display = 'none';
                }, 2500); // Total time = Door Animation (1.5s) + Fade Out (1.5s)
                
                // Try to start music after interaction
                const backgroundMusic = document.getElementById('backgroundMusic');
                if (backgroundMusic && backgroundMusic.paused) {
                    startMusicOnInteraction();
                }
            });

            // Function to update door text based on language
            function updateDoorText(lang) {
                const doorTitleEn = document.getElementById('door-title');
                const doorTitleAr = document.getElementById('door-title-arabic');
                const openDoorTextSpan = document.getElementById('openDoorText');
                const scrollTextSpan = document.getElementById('scrollText');
                
                if (doorTitleEn) doorTitleEn.textContent = content[lang].doorTitle;
                if (doorTitleAr) doorTitleAr.textContent = content[lang].doorTitle;
                if (openDoorTextSpan) openDoorTextSpan.textContent = content[lang].openDoorText;
                if (scrollTextSpan) scrollTextSpan.textContent = content[lang].scrollText;
                
                if (lang === 'ar') {
                    if (doorTitleEn) doorTitleEn.style.display = 'none';
                    if (doorTitleAr) doorTitleAr.style.display = 'block';
                } else {
                    if (doorTitleEn) doorTitleEn.style.display = 'block';
                    if (doorTitleAr) doorTitleAr.style.display = 'none';
                }
            }


            // Language Switching - FIXED VERSION
            function switchLanguage(lang) {
                currentLang = lang;
                
                // Helper function to safely update element text
                function updateElementText(id, text) {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = text;
                    }
                }
                
                // Helper function to safely update element innerHTML
                function updateElementHTML(id, html) {
                    const element = document.getElementById(id);
                    if (element) {
                        element.innerHTML = html;
                    }
                }
                
                // Helper function to safely update element placeholder
                function updateElementPlaceholder(id, placeholder) {
                    const element = document.getElementById(id);
                    if (element) {
                        element.placeholder = placeholder;
                    }
                }
                
                // Update all text content safely
                updateElementText('coupleNames', content[lang].coupleNames);
                updateElementText('weddingDate', content[lang].weddingDate);
                updateElementText('daysLabel', content[lang].daysLabel);
                updateElementText('hoursLabel', content[lang].hoursLabel);
                updateElementText('minutesLabel', content[lang].minutesLabel);
                updateElementText('secondsLabel', content[lang].secondsLabel);
                updateElementText('invitationText', content[lang].invitationText);
                updateElementText('locationTitle', content[lang].locationTitle);
                updateElementText('ceremonyTitle', content[lang].ceremonyTitle);
                updateElementHTML('eventDetails', content[lang].eventDetails);
                updateElementText('mapText', content[lang].mapText);
                updateElementText('wishesTitle', content[lang].wishesTitle);
                updateElementText('wishesSubtitle', content[lang].wishesSubtitle);
                updateElementText('nameLabel', content[lang].nameLabel);
                updateElementPlaceholder('name', content[lang].namePlaceholder);
                updateElementText('messageLabel', content[lang].messageLabel);
                updateElementPlaceholder('message', content[lang].messagePlaceholder);
                updateElementText('submitText', content[lang].submitBtn);
                updateElementText('footerLove', content[lang].footerLove);
                updateElementText('footerCopyright', content[lang].footerCopyright);
                updateElementText('musicText', content[lang].musicText);
                updateElementText('viewMessagesText', content[lang].viewMessagesText);
                updateElementText('magicMessageGalleryTitle', content[lang].magicMessageGalleryTitle);

                // Update language buttons
                const langEn = document.getElementById('langEn');
                const langAr = document.getElementById('langAr');
                if (langEn) langEn.classList.toggle('active', lang === 'en');
                if (langAr) langAr.classList.toggle('active', lang === 'ar');

                // Update RTL/LTR and font classes
                updateTextDirection(lang);
                
                // NEW: Update door text
                updateDoorText(lang);
            }

            function updateTextDirection(lang) {
                const elementsToUpdate = [
                    'coupleNames', 'weddingDate', 'invitationText', 'locationTitle', 
                    'ceremonyTitle', 'eventDetails', 'wishesTitle', 'wishesSubtitle',
                    'nameGroup', 'messageGroup', 'footerLove', 'footerCopyright',
                    'viewMessagesBtn', 'magicMessageGalleryTitle'
                ];

                elementsToUpdate.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.classList.toggle('arabic', lang === 'ar');
                        if (lang === 'ar') {
                            element.style.direction = 'rtl';
                            element.style.textAlign = 'center';
                        } else {
                            element.style.direction = 'ltr';
                            element.style.textAlign = 'center';
                        }
                    }
                });

                // Update form controls
                const nameInput = document.getElementById('name');
                const messageInput = document.getElementById('message');
                const submitBtn = document.getElementById('submitBtn');
                const viewMessagesBtn = document.getElementById('viewMessagesBtn');

                if (nameInput && messageInput && submitBtn && viewMessagesBtn) {
                    if (lang === 'ar') {
                        nameInput.classList.add('arabic');
                        messageInput.classList.add('arabic');
                        submitBtn.classList.add('arabic');
                        viewMessagesBtn.classList.add('arabic');
                        nameInput.style.textAlign = 'right';
                        messageInput.style.textAlign = 'right';
                    } else {
                        nameInput.classList.remove('arabic');
                        messageInput.classList.remove('arabic');
                        submitBtn.classList.remove('arabic');
                        viewMessagesBtn.classList.remove('arabic');
                        nameInput.style.textAlign = 'left';
                        messageInput.style.textAlign = 'left';
                    }
                }
                
                // NEW: Door button styling for RTL
                const openDoorBtn = document.getElementById('openDoorBtn');
                if (openDoorBtn) {
                    openDoorBtn.classList.toggle('arabic', lang === 'ar');
                    openDoorBtn.style.fontFamily = lang === 'ar' ? 'Amiri, serif' : 'Playfair Display, serif';
                    
                    const openDoorIcon = openDoorBtn.querySelector('i');
                    if (openDoorIcon) {
                         if (lang === 'ar') {
                            openDoorIcon.style.marginRight = '10px';
                            openDoorIcon.style.marginLeft = '0';
                         } else {
                            // Reset for LTR
                            openDoorIcon.style.marginRight = '10px';
                            openDoorIcon.style.marginLeft = '0';
                         }
                    }
                }
            }

            // Event listeners for language buttons
            document.getElementById('langEn').addEventListener('click', () => switchLanguage('en'));
            document.getElementById('langAr').addEventListener('click', () => switchLanguage('ar'));

            // Music Player Functionality
            const musicToggle = document.getElementById('musicToggle');
            const musicPlayer = document.getElementById('musicPlayer');
            const backgroundMusic = document.getElementById('backgroundMusic');
            const musicLoading = document.getElementById('musicLoading');
            const musicText = document.getElementById('musicText');
            let isPlaying = false;

            // Auto-play music when page loads
            window.addEventListener('load', async function() {
                console.log("Page loaded, initializing...");
                
                // Initialize audio with random selection
                initAudio();
                
                if (musicLoading) musicLoading.style.display = 'inline';
                if (musicText) musicText.style.display = 'none';

                // Check for flagged messages on page load
                console.log("Checking for flagged messages on page load...");
                await checkFlaggedMessages();

                // Try to play music immediately
                try {
                    const playPromise = backgroundMusic.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            isPlaying = true;
                            if (musicToggle) musicToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                            if (musicPlayer) musicPlayer.classList.add('playing');
                            if (musicLoading) musicLoading.style.display = 'none';
                            if (musicText) musicText.style.display = 'inline';
                            console.log("Music started successfully");
                        }).catch(error => {
                            if (musicLoading) musicLoading.style.display = 'none';
                            if (musicText) {
                                musicText.style.display = 'inline';
                                musicText.textContent = content[currentLang].clickToPlay;
                            }
                            console.log("Music autoplay blocked: " + error);
                            document.addEventListener('click', startMusicOnInteraction, { once: true });
                        });
                    }
                } catch (error) {
                    if (musicLoading) musicLoading.style.display = 'none';
                    if (musicText) {
                        musicText.style.display = 'inline';
                        musicText.textContent = content[currentLang].clickToPlay;
                    }
                    console.log("Music autoplay failed: " + error);
                    document.addEventListener('click', startMusicOnInteraction, { once: true });
                }
            });

            function startMusicOnInteraction() {
                if (musicLoading) musicLoading.style.display = 'inline';
                if (musicText) musicText.style.display = 'none';
                
                backgroundMusic.play().then(() => {
                    isPlaying = true;
                    if (musicToggle) musicToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                    if (musicPlayer) musicPlayer.classList.add('playing');
                    if (musicLoading) musicLoading.style.display = 'none';
                    if (musicText) {
                        musicText.style.display = 'inline';
                        musicText.textContent = content[currentLang].musicText;
                    }
                }).catch(error => {
                    if (musicLoading) musicLoading.style.display = 'none';
                    if (musicText) {
                        musicText.style.display = 'inline';
                        musicText.textContent = 'Music unavailable';
                    }
                });
            }

            // Music toggle functionality
            if (musicToggle) {
                musicToggle.addEventListener('click', function() {
                    if (isPlaying) {
                        backgroundMusic.pause();
                        musicToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
                        musicPlayer.classList.remove('playing');
                        isPlaying = false;
                    } else {
                        backgroundMusic.play().then(() => {
                            musicToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                            musicPlayer.classList.add('playing');
                            isPlaying = true;
                        }).catch(error => {
                            if (musicText) musicText.textContent = content[currentLang].clickToPlay;
                            document.addEventListener('click', startMusicOnInteraction, { once: true });
                        });
                    }
                });
            }

            // Countdown Timer for December 7, 2025
            function updateCountdown() {
                const weddingDate = new Date('December 7, 2025 16:00:00').getTime();
                const now = new Date().getTime();
                const timeLeft = weddingDate - now;
                
                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                const daysEl = document.getElementById('days');
                const hoursEl = document.getElementById('hours');
                const minutesEl = document.getElementById('minutes');
                const secondsEl = document.getElementById('seconds');
                
                if (daysEl) daysEl.innerHTML = days < 10 ? '0' + days : days;
                if (hoursEl) hoursEl.innerHTML = hours < 10 ? '0' + hours : hours;
                if (minutesEl) minutesEl.innerHTML = minutes < 10 ? '0' + minutes : minutes;
                if (secondsEl) secondsEl.innerHTML = seconds < 10 ? '0' + seconds : seconds;
                
                if (timeLeft < 0) {
                    clearInterval(countdownTimer);
                    const message = currentLang === 'en' ? 
                        "<p style='font-size: 1.5rem; color: var(--secondary);'>The wedding has begun! 🎉</p>" :
                        "<p style='font-size: 1.5rem; color: var(--secondary);'>لقد بدأ الحفل! 🎉</p>";
                    const countdownEl = document.querySelector('.countdown');
                    if (countdownEl) countdownEl.innerHTML = message;
                }
            }
            
            const countdownTimer = setInterval(updateCountdown, 1000);
            updateCountdown();
            
            // Create floating particles
            const particlesContainer = document.getElementById('particles-container');
            if (particlesContainer) {
                for (let i = 0; i < 30; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    particle.style.left = Math.random() * 100 + 'vw';
                    particle.style.animationDelay = Math.random() * 15 + 's';
                    particle.style.width = Math.random() * 3 + 2 + 'px';
                    particle.style.height = particle.style.width;
                    particlesContainer.appendChild(particle);
                }
            }
            
            // Create floating hearts (more faded)
            const heartsContainer = document.getElementById('hearts-container');
            if (heartsContainer) {
                for (let i = 0; i < 15; i++) {
                    const heart = document.createElement('div');
                    heart.classList.add('heart');
                    heart.innerHTML = '❤';
                    heart.style.left = Math.random() * 100 + 'vw';
                    heart.style.animationDelay = Math.random() * 15 + 's';
                    heart.style.fontSize = Math.random() * 10 + 8 + 'px';
                    heartsContainer.appendChild(heart);
                }
            }

            // Initialize Arabic fonts and direction
            updateTextDirection('en');
            // Ensure the initial door text is set
            updateDoorText('en');
        </script>
    </body>
    </html>